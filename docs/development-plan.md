# FX バックテストライブラリ開発計画

## 開発方針

### TDD（テスト駆動開発）による段階的実装
t-wadaのTDDアプローチに従い、以下のサイクルで開発を進める：

1. **Red**: 失敗するテストを書く
2. **Green**: テストを通すための最小限のコードを書く
3. **Refactor**: テストを通したままコードを改善する

### 開発フェーズ

## フェーズ1: 基盤コンポーネント開発（1-2週間）

### 1.1 プロジェクトセットアップ
- [ ] Go modulesの初期化
- [ ] ディレクトリ構造の作成
- [ ] 基本的なMakefileの作成
- [ ] CI/CDパイプラインの設定

### 1.2 基本データ構造の実装
**対象**: `pkg/models/`

#### 1.2.1 Candleモデル
```go
// TDDステップ
1. Candleの作成・検証テストを書く
2. 基本的なCandle構造体を実装
3. バリデーション機能を追加
```

#### 1.2.2 Order/Positionモデル
```go
// TDDステップ
1. Order/Positionの作成・操作テストを書く
2. 基本的な構造体を実装
3. ビジネスロジックの追加
```

#### 1.2.3 Configモデル
```go
// TDDステップ
1. 設定の読み込み・検証テストを書く
2. Config構造体を実装
3. デフォルト値とバリデーションを追加
```

### 1.3 CSVデータプロバイダーの実装
**対象**: `pkg/data/`

#### 1.3.1 CSVパーサー
```go
// TDDステップ
1. CSVファイルの読み込みテストを書く（正常系・異常系）
2. 基本的なCSV読み込み機能を実装
3. エラーハンドリングとデータ検証を追加
```

#### 1.3.2 データプロバイダー
```go
// TDDステップ
1. DataProviderインターフェースのテストを書く
2. CSVDataProviderを実装
3. パフォーマンス最適化
```

### 1.4 テストデータの準備
**対象**: `testdata/`
- [ ] サンプルCSVファイルの作成
- [ ] 異常系テスト用データの作成
- [ ] パフォーマンステスト用大容量データの作成

## フェーズ2: ブローカー機能開発（2-3週間）

### 2.1 ブローカーインターフェース設計
**対象**: `pkg/broker/`

#### 2.1.1 モックブローカー
```go
// TDDステップ
1. ブローカーの基本機能テストを書く
2. モックブローカーを実装
3. テストケースの拡充
```

#### 2.1.2 シンプルブローカー
```go
// TDDステップ
1. 注文処理のテストを書く
2. 基本的な注文実行機能を実装
3. ポジション管理機能を追加
4. スプレッド・手数料計算を実装
```

### 2.2 注文処理機能
- [ ] 成行注文の実装
- [ ] 指値注文の実装
- [ ] 逆指値注文の実装
- [ ] ストップロス・テイクプロフィット機能

### 2.3 ポジション管理
- [ ] ポジションの開設・決済
- [ ] 損益計算
- [ ] マージン管理
- [ ] リスク管理機能

## フェーズ3: ストラテジー機能開発（1-2週間）

### 3.1 ストラテジーインターフェース
**対象**: `pkg/strategy/`

#### 3.1.1 基本インターフェース
```go
// TDDステップ
1. ストラテジーの実行テストを書く
2. Strategyインターフェースを実装
3. コールバック機能を追加
```

### 3.2 サンプルストラテジー実装
#### 3.2.1 移動平均クロス戦略
```go
// TDDステップ
1. 移動平均計算のテストを書く
2. 移動平均の計算機能を実装
3. クロス判定ロジックを実装
4. 売買シグナル生成を実装
```

### 3.3 インジケーター機能
**対象**: `pkg/indicators/`
- [ ] 移動平均（SMA, EMA）
- [ ] RSI
- [ ] ボリンジャーバンド
- [ ] MACD

## フェーズ4: バックテスター統合（1-2週間）

### 4.1 バックテスターコア
**対象**: `pkg/backtester/`

#### 4.1.1 実行エンジン
```go
// TDDステップ
1. バックテスト実行のテストを書く
2. 基本的な実行ループを実装
3. 時系列データの処理を実装
4. イベント処理機能を追加
```

### 4.2 統合テスト
- [ ] データ読み込みからバックテスト実行までの統合テスト
- [ ] 異常系の統合テスト
- [ ] パフォーマンステスト

## フェーズ5: 統計・レポート機能（1週間）

### 5.1 統計計算機能
**対象**: `pkg/statistics/`

#### 5.1.1 基本統計
```go
// TDDステップ
1. 損益計算のテストを書く
2. 基本統計の計算機能を実装
3. 高度な統計指標を追加
```

### 5.2 レポート生成
- [ ] 基本レポートの生成
- [ ] 詳細統計レポート
- [ ] JSON/CSV出力機能

## フェーズ6: CLI・使いやすさ向上（1週間）

### 6.1 CLIアプリケーション
**対象**: `cmd/backtester/`
- [ ] コマンドライン引数の処理
- [ ] 設定ファイルの読み込み
- [ ] 実行結果の表示

### 6.2 使用例とドキュメント
**対象**: `examples/`
- [ ] シンプルなバックテスト例
- [ ] 複数ストラテジーの例
- [ ] カスタムインジケーター例

## 開発の進め方

### 1. 各フェーズでの作業手順
```bash
# 1. 該当パッケージのテストファイルを作成
# 2. 失敗するテストを書く
# 3. テストを通すための最小限のコードを書く
# 4. リファクタリング
# 5. 次の機能のテストを書く
```

### 2. 品質保証
- [ ] 各コミット前にテストを実行
- [ ] コードカバレッジ80%以上を維持
- [ ] lintツールでコード品質をチェック
- [ ] パフォーマンステストの実行

### 3. マイルストーン
- **Week 2**: フェーズ1完了（基盤コンポーネント）
- **Week 5**: フェーズ2完了（ブローカー機能）
- **Week 7**: フェーズ3完了（ストラテジー機能）
- **Week 9**: フェーズ4完了（バックテスター統合）
- **Week 10**: フェーズ5完了（統計・レポート）
- **Week 11**: フェーズ6完了（CLI・ドキュメント）

### 4. リスク管理
- [ ] 複雑な機能は早期にプロトタイプを作成
- [ ] 定期的なコードレビュー
- [ ] パフォーマンス問題の早期発見
- [ ] 依存関係の管理

## 成果物
- 完全にテストされたFXバックテストライブラリ
- 使いやすいCLIツール
- 豊富なドキュメントと使用例
- 拡張可能なアーキテクチャ

## 次のステップ
1. Go modulesの初期化
2. 基本的なディレクトリ構造の作成
3. 最初のテストファイルの作成（Candleモデル）
4. TDDサイクルの開始